<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ctypes</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">re</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">overload</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">compat</span><span style="color: brown;">.</span><span style="color: navy;">_optional</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">import_optional_dependency</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">pd</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">interchange</span><span style="color: brown;">.</span><span style="color: navy;">dataframe_protocol</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Buffer</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Column</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ColumnNullType</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DataFrame</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">DataFrameXchg</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">interchange</span><span style="color: brown;">.</span><span style="color: navy;">utils</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrowCTypes</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Endianness</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: navy;">_NP_DTYPES</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">dict</span><span style="color: brown;">[</span><span style="color: navy;">DtypeKind</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">dict</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">]</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">INT</span><span style="color: brown;">:</span>&nbsp;<span style="color: brown;">{</span><span style="color: blue;">8</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">int8</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">16</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">int16</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">32</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">int32</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">64</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">int64</span><span style="color: brown;">}</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">UINT</span><span style="color: brown;">:</span>&nbsp;<span style="color: brown;">{</span><span style="color: blue;">8</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">uint8</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">16</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">uint16</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">32</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">uint32</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">64</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">uint64</span><span style="color: brown;">}</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">FLOAT</span><span style="color: brown;">:</span>&nbsp;<span style="color: brown;">{</span><span style="color: blue;">32</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">float32</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">64</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">float64</span><span style="color: brown;">}</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">BOOL</span><span style="color: brown;">:</span>&nbsp;<span style="color: brown;">{</span><span style="color: blue;">1</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">8</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">}</span><span style="color: brown;">,</span><br><span style="color: brown;">}</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">from_dataframe</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">allow_copy</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Build a ``pd.DataFrame`` from any DataFrame supporting the interchange protocol.

    Parameters
    ----------
    df : DataFrameXchg
        Object supporting the interchange protocol, i.e. `__dataframe__` method.
    allow_copy : bool, default: True
        Whether to allow copying the memory to perform the conversion
        (if false then zero-copy approach is requested).

    Returns
    -------
    pd.DataFrame

    Examples
    --------
    >>> df_not_necessarily_pandas = pd.DataFrame({"</span><span style="color: navy;">A</span><span style="color: green;">": [1, 2], "</span><span style="color: navy;">B</span><span style="color: green;">": [3, 4]})
    >>> interchange_object = df_not_necessarily_pandas.__dataframe__()
    >>> interchange_object.column_names()
    Index(['A', 'B'], dtype='object')
    >>> df_pandas = pd.api.interchange.from_dataframe(
    ...     interchange_object.select_columns_by_name(["</span><span style="color: navy;">A</span><span style="color: green;">"])
    ... )
    >>> df_pandas
         A
    0    1
    1    2

    These methods (``column_names``, ``select_columns_by_name``) should work
    for any dataframe library which implements the interchange protocol.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: navy;">DataFrame</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">df</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">hasattr</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"__dataframe__"</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: green;">"`df` does not support __dataframe__"</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">_from_dataframe</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">df</span><span style="color: brown;">.</span><span style="color: olive;">__dataframe__</span><span style="color: brown;">(</span><span style="color: navy;">allow_copy</span><span style="color: orange;">=</span><span style="color: navy;">allow_copy</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">allow_copy</span><span style="color: orange;">=</span><span style="color: navy;">allow_copy</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_from_dataframe</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DataFrameXchg</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">allow_copy</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Build a ``pd.DataFrame`` from the DataFrame interchange object.

    Parameters
    ----------
    df : DataFrameXchg
        Object supporting the interchange protocol, i.e. `__dataframe__` method.
    allow_copy : bool, default: True
        Whether to allow copying the memory to perform the conversion
        (if false then zero-copy approach is requested).

    Returns
    -------
    pd.DataFrame
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_dfs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">chunk</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">df</span><span style="color: brown;">.</span><span style="color: olive;">get_chunks</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">protocol_df_chunk_to_pandas</span><span style="color: brown;">(</span><span style="color: navy;">chunk</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_dfs</span><span style="color: brown;">.</span><span style="color: olive;">append</span><span style="color: brown;">(</span><span style="color: navy;">pandas_df</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">allow_copy</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">pandas_dfs</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">RuntimeError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"To join chunks a copy is required which is forbidden by allow_copy=False"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">pandas_dfs</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">protocol_df_chunk_to_pandas</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">pandas_dfs</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">pandas_dfs</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: olive;">concat</span><span style="color: brown;">(</span><span style="color: navy;">pandas_dfs</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: blue;">0</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ignore_index</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">copy</span><span style="color: orange;">=</span><span style="color: purple;">False</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">index_obj</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">df</span><span style="color: brown;">.</span><span style="color: navy;">metadata</span><span style="color: brown;">.</span><span style="color: olive;">get</span><span style="color: brown;">(</span><span style="color: green;">"pandas.index"</span><span style="color: brown;">,</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">index_obj</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">index_obj</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">pandas_df</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">protocol_df_chunk_to_pandas</span><span style="color: brown;">(</span><span style="color: navy;">df</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DataFrameXchg</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Convert interchange protocol chunk to ``pd.DataFrame``.

    Parameters
    ----------
    df : DataFrameXchg

    Returns
    -------
    pd.DataFrame
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># We need a dict of columns here, with each column being a NumPy array (at</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># least for now, deal with non-NumPy dtypes later).</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">columns</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">dict</span><span style="color: brown;">[</span><span style="color: navy;">str</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><span style="color: brown;">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">buffers</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span>&nbsp;&nbsp;<span style="color: silver;"># hold on to buffers, keeps memory alive</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">name</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">df</span><span style="color: brown;">.</span><span style="color: olive;">column_names</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">name</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: green;">"Column {name} is not a string"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">name</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">columns</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: green;">"Column {name} is not unique"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">df</span><span style="color: brown;">.</span><span style="color: olive;">get_column_by_name</span><span style="color: brown;">(</span><span style="color: navy;">name</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">dtype</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">INT</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">UINT</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">FLOAT</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">BOOL</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">columns</span><span style="color: brown;">[</span><span style="color: navy;">name</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buf</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">primitive_column_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">CATEGORICAL</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">columns</span><span style="color: brown;">[</span><span style="color: navy;">name</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buf</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">categorical_column_to_series</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">STRING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">columns</span><span style="color: brown;">[</span><span style="color: navy;">name</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buf</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">string_column_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">DATETIME</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">columns</span><span style="color: brown;">[</span><span style="color: navy;">name</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buf</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">datetime_column_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">NotImplementedError</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: green;">"Data type {dtype} not handled yet"</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">buffers</span><span style="color: brown;">.</span><span style="color: olive;">append</span><span style="color: brown;">(</span><span style="color: navy;">buf</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: olive;">DataFrame</span><span style="color: brown;">(</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pandas_df</span><span style="color: brown;">.</span><span style="color: olive;">attrs</span><span style="color: brown;">[</span><span style="color: green;">"_INTERCHANGE_PROTOCOL_BUFFERS"</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">buffers</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">pandas_df</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">primitive_column_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Column</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">ndarray</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Convert a column holding one of the primitive dtypes to a NumPy array.

    A primitive type is one of: int, uint, float, bool.

    Parameters
    ----------
    col : Column

    Returns
    -------
    tuple
        Tuple of np.ndarray holding the data and the memory owner object
        that keeps the memory alive.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">buffers</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">get_buffers</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">data_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"data"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffer_to_ndarray</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">data_dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">offset</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">length</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">size</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">set_nulls</span><span style="color: brown;">(</span><span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"validity"</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buffers</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">categorical_column_to_series</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Column</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: navy;">Series</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Convert a column holding categorical data to a pandas Series.

    Parameters
    ----------
    col : Column

    Returns
    -------
    tuple
        Tuple of pd.Series holding the data and the memory owner object
        that keeps the memory alive.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">categorical</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">describe_categorical</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">categorical</span><span style="color: brown;">[</span><span style="color: green;">"is_dictionary"</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">NotImplementedError</span><span style="color: brown;">(</span><span style="color: green;">"Non-dictionary categoricals not supported yet"</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">cat_column</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">categorical</span><span style="color: brown;">[</span><span style="color: green;">"categories"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">hasattr</span><span style="color: brown;">(</span><span style="color: navy;">cat_column</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"_col"</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Item "Column" of "Optional[Column]" has no attribute "_col"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Item "None" of "Optional[Column]" has no attribute "_col"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">categories</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">array</span><span style="color: brown;">(</span><span style="color: navy;">cat_column</span><span style="color: brown;">.</span><span style="color: navy;">_col</span><span style="color: brown;">)</span>&nbsp;&nbsp;<span style="color: silver;"># type: ignore[union-attr]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">NotImplementedError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Interchanging categorical columns isn't supported yet, and our "</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"fallback of using the `col._col` attribute (a ndarray) failed."</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">buffers</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">get_buffers</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">codes_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">codes_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"data"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">codes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffer_to_ndarray</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">codes_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">codes_dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">offset</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">length</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">size</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Doing module in order to not get ``IndexError`` for</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># out-of-bounds sentinel values in `codes`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">categories</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">categories</span><span style="color: brown;">[</span><span style="color: navy;">codes</span>&nbsp;<span style="color: orange;">%</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">categories</span><span style="color: brown;">)</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">codes</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">cat</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: olive;">Categorical</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">categories</span><span style="color: orange;">=</span><span style="color: navy;">categories</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ordered</span><span style="color: orange;">=</span><span style="color: olive;">categorical</span><span style="color: brown;">[</span><span style="color: green;">"is_ordered"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">pd</span><span style="color: brown;">.</span><span style="color: olive;">Series</span><span style="color: brown;">(</span><span style="color: navy;">cat</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">set_nulls</span><span style="color: brown;">(</span><span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"validity"</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">buffers</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">string_column_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Column</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">ndarray</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Any</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Convert a column holding string data to a NumPy array.

    Parameters
    ----------
    col : Column

    Returns
    -------
    tuple
        Tuple of np.ndarray holding the data and the memory owner object
        that keeps the memory alive.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">null_kind</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">sentinel_val</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">describe_null</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">null_kind</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ColumnNullType</span><span style="color: brown;">.</span><span style="color: navy;">NON_NULLABLE</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ColumnNullType</span><span style="color: brown;">.</span><span style="color: navy;">USE_BITMASK</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ColumnNullType</span><span style="color: brown;">.</span><span style="color: navy;">USE_BYTEMASK</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">NotImplementedError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"{null_kind} null kind is not yet supported for string columns."</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">buffers</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">get_buffers</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"offsets"</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"String buffers must contain offsets"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Retrieve the data buffer containing the UTF-8 code units</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">_</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"data"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># We're going to reinterpret the buffer as uint8, so make sure we can do it safely</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">dtype</span><span style="color: brown;">[</span><span style="color: blue;">2</span><span style="color: brown;">]</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrowCTypes</span><span style="color: brown;">.</span><span style="color: navy;">STRING</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrowCTypes</span><span style="color: brown;">.</span><span style="color: navy;">LARGE_STRING</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span>&nbsp;&nbsp;<span style="color: silver;"># format_str == utf-8</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Convert the buffers to NumPy arrays. In order to go from STRING to</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># an equivalent ndarray, we claim that the buffer is uint8 (i.e., a byte array)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeKind</span><span style="color: brown;">.</span><span style="color: navy;">UINT</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">8</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrowCTypes</span><span style="color: brown;">.</span><span style="color: navy;">UINT8</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Endianness</span><span style="color: brown;">.</span><span style="color: navy;">NATIVE</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Specify zero offset as we don't want to chunk the string data</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffer_to_ndarray</span><span style="color: brown;">(</span><span style="color: navy;">data_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">data_dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset</span><span style="color: orange;">=</span><span style="color: blue;">0</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">length</span><span style="color: orange;">=</span><span style="color: navy;">data_buff</span><span style="color: brown;">.</span><span style="color: navy;">bufsize</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Retrieve the offsets buffer containing the index offsets demarcating</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># the beginning and the ending of each string</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">offset_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"offsets"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Offsets buffer contains start-stop positions of strings in the data buffer,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># meaning that it has more elements than in the data buffer, do `col.size() + 1`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># here to pass a proper offsets buffer size</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">offsets</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffer_to_ndarray</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">offset_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset_dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">offset</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">length</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">size</span><span style="color: brown;">(</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: blue;">1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">null_pos</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">None</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">null_kind</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">ColumnNullType</span><span style="color: brown;">.</span><span style="color: navy;">USE_BITMASK</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ColumnNullType</span><span style="color: brown;">.</span><span style="color: navy;">USE_BYTEMASK</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">validity</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffers</span><span style="color: brown;">[</span><span style="color: green;">"validity"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">validity</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">valid_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">valid_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">validity</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">null_pos</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">buffer_to_ndarray</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">valid_buff</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">valid_dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">offset</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: navy;">offset</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">length</span><span style="color: orange;">=</span><span style="color: navy;">col</span><span style="color: brown;">.</span><span style="color: olive;">size</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">sentinel_val</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">null_pos</span>&nbsp;<span style="color: orange;">=</span>&nbsp;
</pre></body>
</html>