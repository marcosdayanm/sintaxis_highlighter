<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: green;">""</span><span style="color: green;">"Common utility functions for rolling operations"</span><span style="color: green;">""</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">collections</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">defaultdict</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">cast</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">generic</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ABCDataFrame</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ABCSeries</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">indexes</span><span style="color: brown;">.</span><span style="color: navy;">api</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">MultiIndex</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">flex_binary_moment</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">f</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">pairwise</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">False</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ABCSeries</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ABCSeries</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">prep_binary</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ABCDataFrame</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">DataFrame</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: olive;">dataframe_from_int_dict</span><span style="color: brown;">(</span><span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">frame_template</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DataFrame</span><span style="color: brown;">(</span><span style="color: navy;">data</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">index</span><span style="color: orange;">=</span><span style="color: navy;">frame_template</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame_template</span><span style="color: brown;">.</span><span style="color: olive;">columns</span><span style="color: brown;">[</span><span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame_template</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">result</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">results</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><span style="color: brown;">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ABCDataFrame</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">pairwise</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">False</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">arg1</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># special case in order to handle duplicate column names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">dataframe_from_int_dict</span><span style="color: brown;">(</span><span style="color: navy;">results</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">is_unique</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: green;">"'arg1' columns are not unique"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">is_unique</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: green;">"'arg2' columns are not unique"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: olive;">align</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">join</span><span style="color: orange;">=</span><span style="color: green;">"outer"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">prep_binary</span><span style="color: brown;">(</span><span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">union</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">res_columns</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">X</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">Y</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: olive;">X</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">Y</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">DataFrame</span><span style="color: brown;">(</span><span style="color: navy;">results</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">index</span><span style="color: orange;">=</span><span style="color: navy;">X</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">columns</span><span style="color: orange;">=</span><span style="color: navy;">res_columns</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">pairwise</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">results</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">defaultdict</span><span style="color: brown;">(</span><span style="color: navy;">dict</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">j</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">j</span>&nbsp;<span style="color: black;"><</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">arg2</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Symmetric case</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: navy;">j</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">j</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: navy;">j</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red;">*p</span><span style="color: olive;">rep_binary</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">j</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">concat</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result_index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">union</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result_index</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># construct result frame</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">concat</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">concat</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><span style="color: olive;">results</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: navy;">j</span><span style="color: brown;">]</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">j</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ignore_index</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ignore_index</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: blue;">1</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># set the index and reorder</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">nlevels</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># mypy needs to know columns is a MultiIndex, Index doesn't</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># have levels attribute</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">cast</span><span style="color: brown;">(</span><span style="color: navy;">MultiIndex</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># GH 21157: Equivalent to MultiIndex.from_product(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  [result_index], <unique combinations of arg2.columns.levels>,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># )</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># A normal MultiIndex.from_product will produce too many</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># combinations.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result_level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">tile</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result_index</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">//</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result_index</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">arg2_levels</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">repeat</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">get_level_values</span><span style="color: brown;">(</span><span style="color: navy;">i</span><span style="color: brown;">)</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">//</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">nlevels</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result_names</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">result_index</span><span style="color: brown;">.</span><span style="color: navy;">name</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">.</span><span style="color: olive;">from_arrays</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><span style="color: red;">*a</span><span style="color: navy;">rg2_levels</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">result_level</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">names</span><span style="color: orange;">=</span><span style="color: navy;">result_names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># GH 34440</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_levels</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: navy;">levels</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">new_order</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">num_levels</span>&nbsp;<span style="color: orange;">-</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: navy;">num_levels</span>&nbsp;<span style="color: orange;">-</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: olive;">reorder_levels</span><span style="color: brown;">(</span><span style="color: navy;">new_order</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: olive;">sort_index</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">.</span><span style="color: olive;">from_product</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">result_index</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: olive;">swaplevel</span><span style="color: brown;">(</span><span style="color: blue;">1</span><span style="color: brown;">,</span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: olive;">sort_index</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">.</span><span style="color: olive;">from_product</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><span style="color: navy;">result_index</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># empty result</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DataFrame</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">index</span><span style="color: orange;">=</span><span style="color: olive;">MultiIndex</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">levels</span><span style="color: orange;">=</span><span style="color: brown;">[</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">codes</span><span style="color: orange;">=</span><span style="color: brown;">[</span><span style="color: brown;">[</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">columns</span><span style="color: orange;">=</span><span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">dtype</span><span style="color: orange;">=</span><span style="color: green;">"float64"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># reset our index names to arg1 names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># reset our column names to arg2 names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># careful not to mutate the original names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">set_names</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">set_names</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result_index</span><span style="color: brown;">.</span><span style="color: navy;">names</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">result</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">results</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">i</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: red;">*p</span><span style="color: olive;">rep_binary</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">dataframe_from_int_dict</span><span style="color: brown;">(</span><span style="color: navy;">results</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">flex_binary_moment</span><span style="color: brown;">(</span><span style="color: navy;">arg2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">f</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">zsqrt</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">with</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">errstate</span><span style="color: brown;">(</span><span style="color: navy;">all</span><span style="color: orange;">=</span><span style="color: green;">"ignore"</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">sqrt</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mask</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">x</span>&nbsp;<span style="color: black;"><</span>&nbsp;<span style="color: blue;">0</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ABCDataFrame</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">mask</span><span style="color: brown;">.</span><span style="color: navy;">_values</span><span style="color: brown;">.</span><span style="color: olive;">any</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">result</span><span style="color: brown;">[</span><span style="color: navy;">mask</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: blue;">0</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">mask</span><span style="color: brown;">.</span><span style="color: olive;">any</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">result</span><span style="color: brown;">[</span><span style="color: navy;">mask</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: blue;">0</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">result</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">prep_binary</span><span style="color: brown;">(</span><span style="color: navy;">arg1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">arg2</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># mask out values, this also makes a common index...</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">X</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg1</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: blue;">0</span>&nbsp;<span style="color: red;">* </span><span style="color: navy;">arg2</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Y</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">arg2</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: blue;">0</span>&nbsp;<span style="color: red;">* </span><span style="color: navy;">arg1</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">X</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Y</span><br><br>&nbsp;
</pre></body>
</html>