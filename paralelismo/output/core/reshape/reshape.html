<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">itertools</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">cast</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">overload</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">warnings</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_config</span><span style="color: brown;">.</span><span style="color: navy;">config</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">get_option</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span><span style="color: brown;">.</span><span style="color: navy;">reshape</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">libreshape</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">errors</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">PerformanceWarning</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">util</span><span style="color: brown;">.</span><span style="color: navy;">_decorators</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">cache_readonly</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">util</span><span style="color: brown;">.</span><span style="color: navy;">_exceptions</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">find_stack_level</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">cast</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">find_common_type</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">maybe_promote</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ensure_platform_int</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_1d_only_ea_dtype</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_integer</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">needs_i8_conversion</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ExtensionDtype</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">missing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">notna</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">algorithms</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">algos</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">algorithms</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">factorize</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">unique</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">arrays</span><span style="color: brown;">.</span><span style="color: navy;">_mixins</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">NDArrayBackedExtensionArray</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">arrays</span><span style="color: brown;">.</span><span style="color: navy;">categorical</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">factorize_from_iterable</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">construction</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ensure_wrapped_if_datetimelike</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">frame</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">DataFrame</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">indexes</span><span style="color: brown;">.</span><span style="color: navy;">api</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Index</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">RangeIndex</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">reshape</span><span style="color: brown;">.</span><span style="color: navy;">concat</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">concat</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">series</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Series</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">sorting</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">compress_group_index</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">decons_obs_group_ids</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">get_compressed_ids</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">get_group_index</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">get_group_index_sorter</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">if</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrayLike</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Level</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">npt</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">arrays</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ExtensionArray</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">indexes</span><span style="color: brown;">.</span><span style="color: navy;">frozen</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">FrozenList</span><br><br><br><span style="color: purple;">class</span>&nbsp;<span style="color: navy;">_Unstacker</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Helper class to unstack data / pivot with multi-level index

    Parameters
    ----------
    index : MultiIndex
    level : int or str, default last level
        Level to "</span><span style="color: navy;">unstack</span><span style="color: green;">". Accepts a name for the level.
    fill_value : scalar, optional
        Default value to fill in missing values if subgroups do not have the
        same set of labels. By default, missing values will be replaced with
        the default fill value for that data type, NaN for float, NaT for
        datetimelike, etc. For integer types, by default data will converted to
        float and missing values will be set to NaN.
    constructor : object
        Pandas ``DataFrame`` or subclass used to create unstacked
        response.  If None, DataFrame will be used.

    Examples
    --------
    >>> index = pd.MultiIndex.from_tuples(
    ...     [("</span><span style="color: navy;">one</span><span style="color: green;">", "</span><span style="color: navy;">a</span><span style="color: green;">"), ("</span><span style="color: navy;">one</span><span style="color: green;">", "</span><span style="color: navy;">b</span><span style="color: green;">"), ("</span><span style="color: navy;">two</span><span style="color: green;">", "</span><span style="color: navy;">a</span><span style="color: green;">"), ("</span><span style="color: navy;">two</span><span style="color: green;">", "</span><span style="color: navy;">b</span><span style="color: green;">")]
    ... )
    >>> s = pd.Series(np.arange(1, 5, dtype=np.int64), index=index)
    >>> s
    one  a    1
         b    2
    two  a    3
         b    4
    dtype: int64

    >>> s.unstack(level=-1)
         a  b
    one  1  2
    two  3  4

    >>> s.unstack(level=0)
       one  two
    a    1    3
    b    2    4

    Returns
    -------
    unstacked : DataFrame
    "</span><span style="color: green;">""</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: purple;">__init__</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">index</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">level</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Level</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">constructor</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">sort</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">True</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">constructor</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">constructor</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">sort</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">sort</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">remove_unused_levels</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">_get_level_number</span><span style="color: brown;">(</span><span style="color: navy;">level</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># when index includes `nan`, need to lift levels/strides by 1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">lift</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: orange;">-</span><span style="color: blue;">1</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">codes</span><span style="color: brown;">[</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">]</span>&nbsp;<span style="color: purple;">else</span>&nbsp;<span style="color: blue;">0</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Note: the "pop" below alters these in-place.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">new_index_levels</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: navy;">levels</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">new_index_names</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">new_index_names</span><span style="color: brown;">.</span><span style="color: olive;">pop</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">new_index_levels</span><span style="color: brown;">.</span><span style="color: olive;">pop</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level_full</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">levels</span><span style="color: brown;">[</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">sort</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">unique_codes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">unique</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">.</span><span style="color: olive;">codes</span><span style="color: brown;">[</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level</span><span style="color: brown;">.</span><span style="color: olive;">take</span><span style="color: brown;">(</span><span style="color: navy;">unique_codes</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level_full</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level_full</span><span style="color: brown;">.</span><span style="color: olive;">take</span><span style="color: brown;">(</span><span style="color: navy;">unique_codes</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">get_option</span><span style="color: brown;">(</span><span style="color: green;">"performance_warnings"</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Bug fix GH 20601</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># If the data frame is too big, the number of unique index combination</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># will cause int32 overflow on windows environments.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># We want to check and raise an warning before this happens</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_rows</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">max</span><span style="color: brown;">(</span><span style="color: navy;">index_level</span><span style="color: brown;">.</span><span style="color: navy;">size</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">index_level</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">new_index_levels</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">removed_level</span><span style="color: brown;">.</span><span style="color: navy;">size</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># GH20601: This forces an overflow if the number of cells is too high.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># GH 26314: Previous ValueError raised was too restrictive for many users.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_cells</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">num_rows</span>&nbsp;<span style="color: red;">* </span><span style="color: navy;">num_columns</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">num_cells</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">iinfo</span><span style="color: brown;">(</span><span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">int32</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: navy;">max</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">warnings</span><span style="color: brown;">.</span><span style="color: olive;">warn</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"The following operation may generate {num_cells} cells "</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"in the resulting pandas object."</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">PerformanceWarning</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">stacklevel</span><span style="color: orange;">=</span><span style="color: olive;">find_stack_level</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: olive;">_make_selectors</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;
</pre></body>
</html>