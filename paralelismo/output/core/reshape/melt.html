<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">re</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_iterator</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_list_like</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">concat</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">concat_compat</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">missing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">notna</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">algorithms</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">algos</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">indexes</span><span style="color: brown;">.</span><span style="color: navy;">api</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">MultiIndex</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">reshape</span><span style="color: brown;">.</span><span style="color: navy;">concat</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">concat</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">reshape</span><span style="color: brown;">.</span><span style="color: navy;">util</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">tile_compat</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">tools</span><span style="color: brown;">.</span><span style="color: navy;">numeric</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">to_numeric</span><br><br><span style="color: purple;">if</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">collections</span><span style="color: brown;">.</span><span style="color: navy;">abc</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Hashable</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">AnyArrayLike</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">DataFrame</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">ensure_list_vars</span><span style="color: brown;">(</span><span style="color: navy;">arg_vars</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">variable</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">columns</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">list</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">arg_vars</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">is_list_like</span><span style="color: brown;">(</span><span style="color: navy;">arg_vars</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">arg_vars</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">columns</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">arg_vars</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">list</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"{variable} must be a list of tuples when columns are a MultiIndex"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">arg_vars</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">melt</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DataFrame</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">id_vars</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">value_vars</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">value_name</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Hashable</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: green;">"value"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">col_level</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ignore_index</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Unpivot a DataFrame from wide to long format, optionally leaving identifiers set.

    This function is useful to massage a DataFrame into a format where one
    or more columns are identifier variables (`id_vars`), while all other
    columns, considered measured variables (`value_vars`), are "</span><span style="color: navy;">unpivoted</span><span style="color: green;">" to
    the row axis, leaving just two non-identifier columns, 'variable' and
    'value'.

    Parameters
    ----------
    frame : DataFrame
        The DataFrame to unpivot.
    id_vars : scalar, tuple, list, or ndarray, optional
        Column(s) to use as identifier variables.
    value_vars : scalar, tuple, list, or ndarray, optional
        Column(s) to unpivot. If not specified, uses all columns that
        are not set as `id_vars`.
    var_name : scalar, tuple, list, or ndarray, optional
        Name to use for the 'variable' column. If None it uses
        ``frame.columns.name`` or 'variable'. Must be a scalar if columns are a
        MultiIndex.
    value_name : scalar, default 'value'
        Name to use for the 'value' column, can't be an existing column label.
    col_level : scalar, optional
        If columns are a MultiIndex then use this level to melt.
    ignore_index : bool, default True
        If True, original index is ignored. If False, the original index is retained.
        Index labels will be repeated as necessary.

    Returns
    -------
    DataFrame
        Unpivoted DataFrame.

    See Also
    --------
    DataFrame.melt : Identical method.
    pivot_table : Create a spreadsheet-style pivot table as a DataFrame.
    DataFrame.pivot : Return reshaped DataFrame organized
        by given index / column values.
    DataFrame.explode : Explode a DataFrame from list-like
            columns to long format.

    Notes
    -----
    Reference :ref:`the user guide <reshaping.melt>` for more examples.

    Examples
    --------
    >>> df = pd.DataFrame(
    ...     {
    ...         "</span><span style="color: navy;">A</span><span style="color: green;">": {0: "</span><span style="color: navy;">a</span><span style="color: green;">", 1: "</span><span style="color: navy;">b</span><span style="color: green;">", 2: "</span><span style="color: navy;">c</span><span style="color: green;">"},
    ...         "</span><span style="color: navy;">B</span><span style="color: green;">": {0: 1, 1: 3, 2: 5},
    ...         "</span><span style="color: navy;">C</span><span style="color: green;">": {0: 2, 1: 4, 2: 6},
    ...     }
    ... )
    >>> df
    A  B  C
    0  a  1  2
    1  b  3  4
    2  c  5  6

    >>> pd.melt(df, id_vars=["</span><span style="color: navy;">A</span><span style="color: green;">"], value_vars=["</span><span style="color: navy;">B</span><span style="color: green;">"])
    A variable  value
    0  a        B      1
    1  b        B      3
    2  c        B      5

    >>> pd.melt(df, id_vars=["</span><span style="color: navy;">A</span><span style="color: green;">"], value_vars=["</span><span style="color: navy;">B</span><span style="color: green;">", "</span><span style="color: navy;">C</span><span style="color: green;">"])
    A variable  value
    0  a        B      1
    1  b        B      3
    2  c        B      5
    3  a        C      2
    4  b        C      4
    5  c        C      6

    The names of 'variable' and 'value' columns can be customized:

    >>> pd.melt(
    ...     df,
    ...     id_vars=["</span><span style="color: navy;">A</span><span style="color: green;">"],
    ...     value_vars=["</span><span style="color: navy;">B</span><span style="color: green;">"],
    ...     var_name="</span><span style="color: navy;">myVarname</span><span style="color: green;">",
    ...     value_name="</span><span style="color: navy;">myValname</span><span style="color: green;">",
    ... )
    A myVarname  myValname
    0  a         B          1
    1  b         B          3
    2  c         B          5

    Original index values can be kept around:

    >>> pd.melt(df, id_vars=["</span><span style="color: navy;">A</span><span style="color: green;">"], value_vars=["</span><span style="color: navy;">B</span><span style="color: green;">", "</span><span style="color: navy;">C</span><span style="color: green;">"], ignore_index=False)
    A variable  value
    0  a        B      1
    1  b        B      3
    2  c        B      5
    0  a        C      2
    1  b        C      4
    2  c        C      6

    If you have multi-index columns:

    >>> df.columns = [list("</span><span style="color: navy;">ABC</span><span style="color: green;">"), list("</span><span style="color: navy;">DEF</span><span style="color: green;">")]
    >>> df
    A  B  C
    D  E  F
    0  a  1  2
    1  b  3  4
    2  c  5  6

    >>> pd.melt(df, col_level=0, id_vars=["</span><span style="color: navy;">A</span><span style="color: green;">"], value_vars=["</span><span style="color: navy;">B</span><span style="color: green;">"])
    A variable  value
    0  a        B      1
    1  b        B      3
    2  c        B      5

    >>> pd.melt(df, id_vars=[("</span><span style="color: navy;">A</span><span style="color: green;">", "</span><span style="color: navy;">D</span><span style="color: green;">")], value_vars=[("</span><span style="color: navy;">B</span><span style="color: green;">", "</span><span style="color: navy;">E</span><span style="color: green;">")])
    (A, D) variable_0 variable_1  value
    0      a          B          E      1
    1      b          B          E      3
    2      c          B          E      5
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">value_name</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"value_name ({value_name}) cannot match an element in "</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"the DataFrame columns."</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">id_vars</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ensure_list_vars</span><span style="color: brown;">(</span><span style="color: navy;">id_vars</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"id_vars"</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">value_vars_was_not_none</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">value_vars</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">value_vars</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ensure_list_vars</span><span style="color: brown;">(</span><span style="color: navy;">value_vars</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"value_vars"</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">id_vars</span>&nbsp;<span style="color: purple;">or</span>&nbsp;<span style="color: navy;">value_vars</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">col_level</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">get_level_values</span><span style="color: brown;">(</span><span style="color: navy;">col_level</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">labels</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">id_vars</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: navy;">value_vars</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">idx</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">level</span><span style="color: brown;">.</span><span style="color: olive;">get_indexer_for</span><span style="color: brown;">(</span><span style="color: navy;">labels</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">missing</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">idx</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: orange;">-</span><span style="color: blue;">1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">missing</span><span style="color: brown;">.</span><span style="color: olive;">any</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">missing_labels</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lab</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">lab</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">not_found</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">zip</span><span style="color: brown;">(</span><span style="color: navy;">labels</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">missing</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">not_found</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">KeyError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"The following id_vars or value_vars are not present in "</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"the DataFrame: {missing_labels}"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">value_vars_was_not_none</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">algos</span><span style="color: brown;">.</span><span style="color: olive;">unique</span><span style="color: brown;">(</span><span style="color: navy;">idx</span><span style="color: brown;">)</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">col_level</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span>&nbsp;&nbsp;<span style="color: silver;"># allow list or other?</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># frame is a copy</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">get_level_values</span><span style="color: brown;">(</span><span style="color: navy;">col_level</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: olive;">set</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">f</span><span style="color: green;">"variable_{i}"</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">names</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">name</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: navy;">name</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span>&nbsp;<span style="color: purple;">else</span>&nbsp;<span style="color: green;">"variable"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: olive;">is_list_like</span><span style="color: brown;">(</span><span style="color: navy;">var_name</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">MultiIndex</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">is_iterator</span><span style="color: brown;">(</span><span style="color: navy;">var_name</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">var_name</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">var_name</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"{var_name=} has {len(var_name)} items, "</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: green;">"but the dataframe columns only have {len(frame.columns)} levels."</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">ValueError</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: green;">"{var_name=} must be a scalar."</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">var_name</span><span style="color: brown;">]</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_rows</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">K</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">num_cols_adjusted</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">K</span>&nbsp;<span style="color: orange;">-</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">id_vars</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mdata</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">dict</span><span style="color: brown;">[</span><span style="color: navy;">Hashable</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">AnyArrayLike</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><span style="color: brown;">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">id_vars</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">id_data</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">pop</span><span style="color: brown;">(</span><span style="color: navy;">col</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">id_data</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># i.e. ExtensionDtype</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">num_cols_adjusted</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">concat</span><span style="color: brown;">(</span><span style="color: brown;">[</span><span style="color: navy;">id_data</span><span style="color: brown;">]</span>&nbsp;<span style="color: red;">* </span><span style="color: navy;">num_cols_adjusted</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ignore_index</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># We can't concat empty list. (GH 46044)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">type</span><span style="color: brown;">(</span><span style="color: navy;">id_data</span><span style="color: brown;">)</span><span style="color: brown;">(</span><span style="color: brown;">[</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">name</span><span style="color: orange;">=</span><span style="color: navy;">id_data</span><span style="color: brown;">.</span><span style="color: navy;">name</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">dtype</span><span style="color: orange;">=</span><span style="color: navy;">id_data</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">tile</span><span style="color: brown;">(</span><span style="color: navy;">id_data</span><span style="color: brown;">.</span><span style="color: navy;">_values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">num_cols_adjusted</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mcolumns</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">id_vars</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: navy;">var_name</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">value_name</span><span style="color: brown;">]</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">shape</span><span style="color: brown;">[</span><span style="color: blue;">1</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">any</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">dt</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">dt</span><span style="color: brown;">.</span><span style="color: navy;">_supports_2d</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">dt</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">value_name</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">concat</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">iloc</span><span style="color: brown;">[</span><span style="color: brown;">:</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">]</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: purple;">range</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">shape</span><span style="color: brown;">[</span><span style="color: blue;">1</span><span style="color: brown;">]</span><span style="color: brown;">)</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ignore_index</span><span style="color: orange;">=</span><span style="color: purple;">True</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: navy;">values</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">value_name</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">_values</span><span style="color: brown;">.</span><span style="color: olive;">ravel</span><span style="color: brown;">(</span><span style="color: green;">"F"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">col</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">enumerate</span><span style="color: brown;">(</span><span style="color: navy;">var_name</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mdata</span><span style="color: brown;">[</span><span style="color: navy;">col</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">columns</span><span style="color: brown;">.</span><span style="color: olive;">_get_level_values</span><span style="color: brown;">(</span><span style="color: navy;">i</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: olive;">repeat</span><span style="color: brown;">(</span><span style="color: navy;">num_rows</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: olive;">_constructor</span><span style="color: brown;">(</span><span style="color: navy;">mdata</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">columns</span><span style="color: orange;">=</span><span style="color: navy;">mcolumns</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">ignore_index</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">result</span><span style="color: brown;">.</span><span style="color: navy;">index</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">tile_compat</span><span style="color: brown;">(</span><span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">index</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">num_cols_adjusted</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">result</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">lreshape</span><span style="color: brown;">(</span><span style="color: navy;">data</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DataFrame</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">groups</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">dict</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">dropna</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">DataFrame</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Reshape wide-format data to long. Generalized inverse of DataFrame.pivot.

    Accepts a dictionary, ``groups``, in which each key is a new column name
    and each value is a list of old column names that will be "</span><span style="color: navy;">melted</span><span style="color: green;">" under
    the new column name as part of the reshape.

    Parameters
    ----------
    data : DataFrame
        The wide-format DataFrame.
    groups : dict
        {new_name : list_of_columns}.
    dropna : bool, default True
        Do not include columns whose entries are all NaN.

    Returns
    -------
    DataFrame
        Reshaped DataFrame.

    See Also
    --------
    melt : Unpivot a DataFrame from wide to long format, optionally leaving
        identifiers set.
    pivot : Create a spreadsheet-style pivot table as a DataFrame.
    DataFrame.pivot : Pivot without aggregation that can handle
        non-numeric data.
    DataFrame.pivot_table : Generalization of pivot that can handle
        duplicate values for one index/column pair.
    DataFrame.unstack : Pivot based on the index values instead of a
        column.
    wide_to_long : Wide panel to long format. Less flexible but more
        user-friendly than melt.

    Examples
    --------
    >>> data = pd.DataFrame(
    ...     {
    ...         "</span><span style="color: navy;">hr1</span><span style="color: green;">": [514, 573],
    ...         "</span><span style="color: navy;">hr2</span><span style="color: green;">": [545, 526],
    ...         "</span><span style="color: navy;">team</span><span style="color: green;">": ["</span><span style="color: navy;">Red</span>&nbsp;<span style="color: navy;">Sox</span><span style="color: green;">", "</span><span style="color: navy;">Yankees</span><span style="color: green;">"],
    ...         "</span><span style="color: navy;">year1</span><span style="color: green;">": [2007, 2007],
    ...         "</span><span style="color: navy;">year2</span><span style="color: green;">": [2008, 2008],
    ...     }
    ... )
    >>> data
       hr1  hr2     team  year1  year2
    0  514  545  Red Sox   2007   2008
    1  573  526  Yankees   2007   2008

    >>> pd.lreshape(data, {"</span><span style="color: navy;">year</span><span style="color: green;">": ["</span><span style="color: navy;">year1</span><span style="color: green;">", "</span><span style="color: navy;">year2</span><span style="color: green;">"], "</span><span style="color: navy;">hr</span><span style="color: green;">": ["</span><span style="color: navy;">hr1</span><span style="color: green;">", "</span><span style="color: navy;">hr2</span><span style="color: green;">"]})
          team  year   hr
    0  Red Sox  2007  514
    1  Yankees  2007  573
    2  Red Sox  2008  545
    3  Yankees  2008  526
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mdata</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><span style="color: brown;">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pivot_cols</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">all_cols</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">set</span><span style="color: brown;">[</span><span style="color: navy;">Hashable</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">set</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">K</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: olive;">next</span><span style="color: brown;">(</span><span style="color: olive;">iter</span><span style="color: brown;">(</span><span style="color: navy;">groups</span><span style="color: brown;">.</span><span style="color: olive;">values</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">target</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">names</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">groups</span><span style="color: brown;">.</span><span style="color: olive;">items</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">names</span><span style="color: brown;">)</span>&nbsp;
</pre></body>
</html>