<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">cast</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">NaT</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">algos</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">libalgos</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">internals</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">libinternals</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lib</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span><span style="color: brown;">.</span><span style="color: navy;">missing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">NA</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">util</span><span style="color: brown;">.</span><span style="color: navy;">_decorators</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">cache_readonly</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">cast</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ensure_dtype_can_hold_na</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">find_common_type</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_1d_only_ea_dtype</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">needs_i8_conversion</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">concat</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">concat_compat</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ExtensionDtype</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">missing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">is_valid_na_for_dtype</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">construction</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ensure_wrapped_if_datetimelike</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ensure_block_shape</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">new_block_2d</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">managers</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">make_na_array</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">if</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">collections</span><span style="color: brown;">.</span><span style="color: navy;">abc</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Generator</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Sequence</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrayLike</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">AxisInt</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DtypeObj</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Shape</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Index</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Block</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">BlockPlacement</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">concatenate_managers</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: navy;">Index</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">concat_axis</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">AxisInt</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">copy</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Concatenate block managers into one.

    Parameters
    ----------
    mgrs_indexers : list of (BlockManager, {axis: indexer,...}) tuples
    axes : list of Index
    concat_axis : int
    copy : bool

    Returns
    -------
    BlockManager
    "</span><span style="color: green;">""</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">needs_copy</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">copy</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">concat_axis</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">0</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Assertions disabled for performance</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># for tup in mgrs_indexers:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    # caller is responsible for ensuring this</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    indexers = tup[1]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert concat_axis not in indexers</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">concat_axis</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgrs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_maybe_reindex_columns_na_proxy</span><span style="color: brown;">(</span><span style="color: navy;">axes</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">needs_copy</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">mgrs</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">.</span><span style="color: olive;">concat_horizontal</span><span style="color: brown;">(</span><span style="color: navy;">mgrs</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">mgrs_indexers</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">mgrs_indexers</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">.</span><span style="color: navy;">nblocks</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">0</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">first_dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">mgrs_indexers</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">.</span><span style="color: olive;">blocks</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">first_dtype</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">float64</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">float32</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># TODO: support more dtypes here.  This will be simpler once</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  JoinUnit.is_na behavior is deprecated.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  (update 2024-04-13 that deprecation has been enforced)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">all</span><span style="color: brown;">(</span><span style="color: olive;">_is_homogeneous_mgr</span><span style="color: brown;">(</span><span style="color: navy;">mgr</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">first_dtype</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">_</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">mgrs_indexers</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Fastpath!</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Length restriction is just to avoid having to worry about 'copy'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">shape</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">(</span><span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">x</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">nb</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_concat_homogeneous_fastpath</span><span style="color: brown;">(</span><span style="color: navy;">mgrs_indexers</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">shape</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">first_dtype</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">BlockManager</span><span style="color: brown;">(</span><span style="color: brown;">(</span><span style="color: navy;">nb</span><span style="color: brown;">,</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgrs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_maybe_reindex_columns_na_proxy</span><span style="color: brown;">(</span><span style="color: navy;">axes</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">needs_copy</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">mgrs</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgr</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">mgrs</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">out</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: navy;">deep</span><span style="color: orange;">=</span><span style="color: purple;">False</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">out</span><span style="color: brown;">.</span><span style="color: navy;">axes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">axes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">out</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">blocks</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">ArrayLike</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">placement</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">join_units</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">_get_combined_plan</span><span style="color: brown;">(</span><span style="color: navy;">mgrs</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">unit</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">join_units</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">blk</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">unit</span><span style="color: brown;">.</span><span style="color: navy;">block</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">_is_uniform_join_units</span><span style="color: brown;">(</span><span style="color: navy;">join_units</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">vals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: navy;">ju</span><span style="color: brown;">.</span><span style="color: navy;">block</span><span style="color: brown;">.</span><span style="color: navy;">values</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">ju</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">join_units</span><span style="color: brown;">]</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: navy;">is_extension</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># _is_uniform_join_units ensures a single dtype, so</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  we can use np.concatenate, which is more performant</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  than concat_compat</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># error: Argument 1 to "concatenate" has incompatible type</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># "List[Union[ndarray[Any, Any], ExtensionArray]]";</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># expected "Union[_SupportsArray[dtype[Any]],</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># _NestedSequence[_SupportsArray[dtype[Any]]]]"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: olive;">concatenate</span><span style="color: brown;">(</span><span style="color: navy;">vals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: blue;">1</span><span style="color: brown;">)</span>&nbsp;&nbsp;<span style="color: silver;"># type: ignore[arg-type]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: olive;">is_1d_only_ea_dtype</span><span style="color: brown;">(</span><span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># TODO(EA2D): special-casing not needed with 2D EAs</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">concat_compat</span><span style="color: brown;">(</span><span style="color: navy;">vals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: blue;">0</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ea_compat_axis</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ensure_block_shape</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ndim</span><span style="color: orange;">=</span><span style="color: blue;">2</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">concat_compat</span><span style="color: brown;">(</span><span style="color: navy;">vals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: blue;">1</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ensure_wrapped_if_datetimelike</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">fastpath</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: navy;">values</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">values</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_concatenate_join_units</span><span style="color: brown;">(</span><span style="color: navy;">join_units</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">copy</span><span style="color: orange;">=</span><span style="color: navy;">copy</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">fastpath</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: purple;">False</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">fastpath</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">b</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: olive;">make_block_same_class</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">placement</span><span style="color: orange;">=</span><span style="color: navy;">placement</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">b</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">new_block_2d</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">placement</span><span style="color: orange;">=</span><span style="color: navy;">placement</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">blocks</span><span style="color: brown;">.</span><span style="color: olive;">append</span><span style="color: brown;">(</span><span style="color: navy;">b</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">BlockManager</span><span style="color: brown;">(</span><span style="color: olive;">tuple</span><span style="color: brown;">(</span><span style="color: navy;">blocks</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_maybe_reindex_columns_na_proxy</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">axes</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: navy;">Index</span><span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">dict</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">ndarray</span><span style="color: brown;">]</span><span style="color: brown;">]</span><span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">needs_copy</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: navy;">BlockManager</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Reindex along columns so that all of the BlockManagers being concatenated
    have matching columns.

    Columns added in this reindexing have dtype=np.void, indicating they
    should be ignored when choosing a column's final dtype.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">new_mgrs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">indexers</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">mgrs_indexers</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># For axis=0 (i.e. columns) we use_na_proxy and only_slice, so this</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  is a cheap reindexing.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">i</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">indexer</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">indexers</span><span style="color: brown;">.</span><span style="color: olive;">items</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgr</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">.</span><span style="color: olive;">reindex_indexer</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">axes</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">indexers</span><span style="color: brown;">[</span><span style="color: navy;">i</span><span style="color: brown;">]</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">axis</span><span style="color: orange;">=</span><span style="color: navy;">i</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">only_slice</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span>&nbsp;&nbsp;<span style="color: silver;"># only relevant for i==0</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">allow_dups</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">use_na_proxy</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">,</span>&nbsp;&nbsp;<span style="color: silver;"># only relevant for i==0</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">needs_copy</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">indexers</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">mgr</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">new_mgrs</span><span style="color: brown;">.</span><span style="color: olive;">append</span><span style="color: brown;">(</span><span style="color: navy;">mgr</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">new_mgrs</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_is_homogeneous_mgr</span><span style="color: brown;">(</span><span style="color: navy;">mgr</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">first_dtype</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DtypeObj</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Check if this Manager can be treated as a single ndarray.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">mgr</span><span style="color: brown;">.</span><span style="color: navy;">nblocks</span>&nbsp;
</pre></body>
</html>