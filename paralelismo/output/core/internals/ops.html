<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">NamedTuple</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">is_1d_only_ea_dtype</span><br><br><span style="color: purple;">if</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">collections</span><span style="color: brown;">.</span><span style="color: navy;">abc</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Iterator</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span><span style="color: brown;">.</span><span style="color: navy;">internals</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">BlockPlacement</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ArrayLike</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Block</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">managers</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">BlockManager</span><br><br><br><span style="color: purple;">class</span>&nbsp;<span style="color: olive;">BlockPairInfo</span><span style="color: brown;">(</span><span style="color: navy;">NamedTuple</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">ArrayLike</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">ArrayLike</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">locs</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockPlacement</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">left_ea</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Block</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_iter_block_pairs</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">left</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">Iterator</span><span style="color: brown;">[</span><span style="color: navy;">BlockPairInfo</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># At this point we have already checked the parent DataFrames for</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert rframe._indexed_same(lframe)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">blk</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">left</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">locs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">blk_vals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">blk</span><span style="color: brown;">.</span><span style="color: navy;">values</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">left_ea</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">blk_vals</span><span style="color: brown;">.</span><span style="color: navy;">ndim</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">rblks</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">.</span><span style="color: olive;">_slice_take_blocks_ax0</span><span style="color: brown;">(</span><span style="color: navy;">locs</span><span style="color: brown;">.</span><span style="color: navy;">indexer</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">only_slice</span><span style="color: orange;">=</span><span style="color: purple;">True</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Assertions are disabled for performance, but should hold:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># if left_ea:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert len(locs) == 1, locs</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert len(rblks) == 1, rblks</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert rblks[0].shape[0] == 1, rblks[0].shape</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">rblk</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">rblks</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">right_ea</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">values</span><span style="color: brown;">.</span><span style="color: navy;">ndim</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_get_same_shape_values</span><span style="color: brown;">(</span><span style="color: navy;">blk</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">left_ea</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">info</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">BlockPairInfo</span><span style="color: brown;">(</span><span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">locs</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">left_ea</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">yield</span>&nbsp;<span style="color: navy;">info</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">operate_blockwise</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">left</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">array_op</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># At this point we have already checked the parent DataFrames for</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert rframe._indexed_same(lframe)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_blks</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: navy;">Block</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">locs</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">left_ea</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rblk</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">_iter_block_pairs</span><span style="color: brown;">(</span><span style="color: navy;">left</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">array_op</span><span style="color: brown;">(</span><span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">left_ea</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">right_ea</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">hasattr</span><span style="color: brown;">(</span><span style="color: navy;">res_values</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"reshape"</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">is_1d_only_ea_dtype</span><span style="color: brown;">(</span><span style="color: navy;">res_values</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">res_values</span><span style="color: brown;">.</span><span style="color: olive;">reshape</span><span style="color: brown;">(</span><span style="color: blue;">1</span><span style="color: brown;">,</span>&nbsp;<span style="color: orange;">-</span><span style="color: blue;">1</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">nbs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: olive;">_split_op_result</span><span style="color: brown;">(</span><span style="color: navy;">res_values</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Assertions are disabled for performance, but should hold:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># if right_ea or left_ea:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert len(nbs) == 1</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># else:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#    assert res_values.shape == lvals.shape, (res_values.shape, lvals.shape)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">_reset_block_mgr_locs</span><span style="color: brown;">(</span><span style="color: navy;">nbs</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">locs</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_blks</span><span style="color: brown;">.</span><span style="color: olive;">extend</span><span style="color: brown;">(</span><span style="color: navy;">nbs</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Assertions are disabled for performance, but should hold:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  slocs = {y for nb in res_blks for y in nb.mgr_locs.as_array}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  nlocs = sum(len(nb.mgr_locs.as_array) for nb in res_blks)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert nlocs == len(left.items), (nlocs, len(left.items))</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert len(slocs) == nlocs, (len(slocs), nlocs)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert slocs == set(range(nlocs)), slocs</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">new_mgr</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">type</span><span style="color: brown;">(</span><span style="color: navy;">right</span><span style="color: brown;">)</span><span style="color: brown;">(</span><span style="color: olive;">tuple</span><span style="color: brown;">(</span><span style="color: navy;">res_blks</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">axes</span><span style="color: orange;">=</span><span style="color: navy;">right</span><span style="color: brown;">.</span><span style="color: navy;">axes</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">verify_integrity</span><span style="color: orange;">=</span><span style="color: purple;">False</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">new_mgr</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_reset_block_mgr_locs</span><span style="color: brown;">(</span><span style="color: navy;">nbs</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">list</span><span style="color: brown;">[</span><span style="color: navy;">Block</span><span style="color: brown;">]</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">locs</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Reset mgr_locs to correspond to our original DataFrame.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">nb</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">nbs</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">nblocs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">locs</span><span style="color: brown;">[</span><span style="color: navy;">nb</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><span style="color: brown;">.</span><span style="color: navy;">indexer</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">nb</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">nblocs</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Assertions are disabled for performance, but should hold:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert len(nblocs) == nb.shape[0], (len(nblocs), nb.shape)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;">#  assert all(x in locs.as_array for x in nb.mgr_locs.as_array)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_get_same_shape_values</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lblk</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Block</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Block</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">left_ea</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">bool</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">ArrayLike</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ArrayLike</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Slice lblk.values to align with rblk.  Squeeze if we have EAs.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">lblk</span><span style="color: brown;">.</span><span style="color: navy;">values</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">rvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">values</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># Require that the indexing into lvals be slice-like</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><span style="color: brown;">.</span><span style="color: navy;">is_slice_like</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># TODO(EA2D): with 2D EAs only this first clause would be needed</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">left_ea</span>&nbsp;<span style="color: purple;">or</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># error: No overload variant of "__getitem__" of "ExtensionArray" matches</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># argument type "Tuple[Union[ndarray, slice], slice]"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">lvals</span><span style="color: brown;">[</span><span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><span style="color: brown;">.</span><span style="color: navy;">indexer</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">:</span><span style="color: brown;">]</span>&nbsp;&nbsp;<span style="color: silver;"># type: ignore[call-overload]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">left_ea</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">right_ea</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># lvals are 2D, rvals are 1D</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># error: No overload variant of "__getitem__" of "ExtensionArray" matches</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># argument type "Tuple[Union[ndarray, slice], slice]"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">lvals</span><span style="color: brown;">[</span><span style="color: navy;">rblk</span><span style="color: brown;">.</span><span style="color: navy;">mgr_locs</span><span style="color: brown;">.</span><span style="color: navy;">indexer</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">:</span><span style="color: brown;">]</span>&nbsp;&nbsp;<span style="color: silver;"># type: ignore[call-overload]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: olive;">shape</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">lvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">lvals</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">:</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">else</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># lvals are 1D, rvals are 2D</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: olive;">shape</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><span style="color: brown;">.</span><span style="color: navy;">shape</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># error: No overload variant of "__getitem__" of "ExtensionArray" matches</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># argument type "Tuple[int, slice]"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">rvals</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">rvals</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">:</span><span style="color: brown;">]</span>&nbsp;&nbsp;<span style="color: silver;"># type: ignore[call-overload]</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">rvals</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">blockwise_all</span><span style="color: brown;">(</span><span style="color: navy;">left</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">BlockManager</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">op</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">bool</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Blockwise `all` reduction.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">info</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">_iter_block_pairs</span><span style="color: brown;">(</span><span style="color: navy;">left</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">right</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">op</span><span style="color: brown;">(</span><span style="color: navy;">info</span><span style="color: brown;">.</span><span style="color: navy;">lvals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">info</span><span style="color: brown;">.</span><span style="color: navy;">rvals</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: navy;">res</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: purple;">False</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: purple;">True</span><br><br>&nbsp;
</pre></body>
</html>