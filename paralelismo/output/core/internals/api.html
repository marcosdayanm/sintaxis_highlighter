<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: green;">""</span><span style="color: green;">"
This is a pseudo-public API for downstream libraries.  We ask that downstream
authors

1) Try to avoid using internals directly altogether, and failing that,
2) Use only functions exposed here (or in core.internals)

"</span><span style="color: green;">""</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">warnings</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span><span style="color: brown;">.</span><span style="color: navy;">internals</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">BlockPlacement</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas_dtype</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span><span style="color: brown;">.</span><span style="color: navy;">dtypes</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DatetimeTZDtype</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ExtensionDtype</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">PeriodDtype</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">arrays</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">DatetimeArray</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">TimedeltaArray</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">construction</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">extract_array</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">check_ndim</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ensure_block_shape</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">extract_pandas_array</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">get_block_type</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">maybe_coerce_values</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">if</span>&nbsp;<span style="color: navy;">TYPE_CHECKING</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ArrayLike</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Dtype</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">internals</span><span style="color: brown;">.</span><span style="color: navy;">blocks</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Block</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_make_block</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">ArrayLike</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">placement</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">ndarray</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">Block</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    This is an analogue to blocks.new_block(_2d) that ensures:
    1) correct dimension for EAs that support 2D (`ensure_block_shape`), and
    2) correct EA class for datetime64/timedelta64 (`maybe_coerce_values`).

    The input `values` is assumed to be either numpy array or ExtensionArray:
    - In case of a numpy array, it is assumed to already be in the expected
      shape for Blocks (2D, (cols, rows)).
    - In case of an ExtensionArray the input can be 1D, also for EAs that are
      internally stored as 2D.

    For the rest no preprocessing or validation is done, except for those dtypes
    that are internally stored as EAs but have an exact numpy equivalent (and at
    the moment use that numpy dtype), i.e. datetime64/timedelta64.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">dtype</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">values</span><span style="color: brown;">.</span><span style="color: navy;">dtype</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">klass</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">get_block_type</span><span style="color: brown;">(</span><span style="color: navy;">dtype</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">placement_obj</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">BlockPlacement</span><span style="color: brown;">(</span><span style="color: navy;">placement</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: brown;">(</span><span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">dtype</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ExtensionDtype</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">dtype</span><span style="color: brown;">.</span><span style="color: navy;">_supports_2d</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">or</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">DatetimeArray</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">TimedeltaArray</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ensure_block_shape</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ndim</span><span style="color: orange;">=</span><span style="color: blue;">2</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">maybe_coerce_values</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">klass</span><span style="color: brown;">(</span><span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ndim</span><span style="color: orange;">=</span><span style="color: blue;">2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">placement</span><span style="color: orange;">=</span><span style="color: navy;">placement_obj</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">make_block</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">values</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">placement</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">klass</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ndim</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">dtype</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Dtype</span>&nbsp;
</pre></body>
</html>