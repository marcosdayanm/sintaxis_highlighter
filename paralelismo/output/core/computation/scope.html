<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: green;">""</span><span style="color: green;">"
Module for scope operations
"</span><span style="color: green;">""</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">collections</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ChainMap</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">datetime</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">inspect</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">io</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">StringIO</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">itertools</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pprint</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">struct</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">sys</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">TypeVar</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">_libs</span><span style="color: brown;">.</span><span style="color: navy;">tslibs</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Timestamp</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">errors</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">UndefinedVariableError</span><br><br><span style="color: navy;">_KT</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">TypeVar</span><span style="color: brown;">(</span><span style="color: green;">"_KT"</span><span style="color: brown;">)</span><br><span style="color: navy;">_VT</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">TypeVar</span><span style="color: brown;">(</span><span style="color: green;">"_VT"</span><span style="color: brown;">)</span><br><br><br><span style="color: silver;"># https://docs.python.org/3/library/collections.html#chainmap-examples-and-recipes</span><br><span style="color: purple;">class</span>&nbsp;<span style="color: olive;">DeepChainMap</span><span style="color: brown;">(</span><span style="color: olive;">ChainMap</span><span style="color: brown;">[</span><span style="color: navy;">_KT</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">_VT</span><span style="color: brown;">]</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Variant of ChainMap that allows direct updates to inner scopes.

    Only works when all passed mapping are mutable.
    "</span><span style="color: green;">""</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: purple;">__setitem__</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">key</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">_KT</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">value</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">_VT</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">mapping</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">maps</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">key</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">mapping</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: olive;">mapping</span><span style="color: brown;">[</span><span style="color: navy;">key</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">value</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: olive;">maps</span><span style="color: brown;">[</span><span style="color: blue;">0</span><span style="color: brown;">]</span><span style="color: brown;">[</span><span style="color: navy;">key</span><span style="color: brown;">]</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">value</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: purple;">__delitem__</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">key</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">_KT</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
        Raises
        ------
        KeyError
            If `key` doesn't exist.
        "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">mapping</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">maps</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">key</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">mapping</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">del</span>&nbsp;<span style="color: olive;">mapping</span><span style="color: brown;">[</span><span style="color: navy;">key</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">raise</span>&nbsp;<span style="color: purple;">KeyError</span><span style="color: brown;">(</span><span style="color: navy;">key</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">ensure_scope</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">level</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">global_dict</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">local_dict</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">resolvers</span><span style="color: orange;">=</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">target</span><span style="color: orange;">=</span><span style="color: purple;">None</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">Scope</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"Ensure that we are grabbing the correct scope."</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">Scope</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">level</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">global_dict</span><span style="color: orange;">=</span><span style="color: navy;">global_dict</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">local_dict</span><span style="color: orange;">=</span><span style="color: navy;">local_dict</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">resolvers</span><span style="color: orange;">=</span><span style="color: navy;">resolvers</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">target</span><span style="color: orange;">=</span><span style="color: navy;">target</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_replacer</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Replace a number with its hexadecimal representation. Used to tag
    temporary variables with their calling scope's id.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># get the hex repr of the binary char and remove 0x and pad by pad_size</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># zeros</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">try</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">hexin</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">ord</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">except</span>&nbsp;<span style="color: purple;">TypeError</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># bytes literals masquerade as ints when iterating in py3</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">hexin</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">x</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">hex</span><span style="color: brown;">(</span><span style="color: navy;">hexin</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_raw_hex_id</span><span style="color: brown;">(</span><span style="color: navy;">obj</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"Return the padded hexadecimal id of ``obj``."</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># interpret as a pointer since that's what really what id returns</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">packed</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">struct</span><span style="color: brown;">.</span><span style="color: olive;">pack</span><span style="color: brown;">(</span><span style="color: green;">"@P"</span><span style="color: brown;">,</span>&nbsp;<span style="color: olive;">id</span><span style="color: brown;">(</span><span style="color: navy;">obj</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: green;">""</span><span style="color: brown;">.</span><span style="color: olive;">join</span><span style="color: brown;">(</span><span style="color: brown;">[</span><span style="color: olive;">_replacer</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">x</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">packed</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br><br><br><span style="color: navy;">DEFAULT_GLOBALS</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Timestamp"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">Timestamp</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"datetime"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">datetime</span><span style="color: brown;">.</span><span style="color: navy;">datetime</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"True"</span><span style="color: brown;">:</span>&nbsp;<span style="color: purple;">True</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"False"</span><span style="color: brown;">:</span>&nbsp;<span style="color: purple;">False</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"list"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">list</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"tuple"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">tuple</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"inf"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">inf</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Inf"</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">np</span><span style="color: brown;">.</span><span style="color: navy;">inf</span><span style="color: brown;">,</span><br><span style="color: brown;">}</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_get_pretty_string</span><span style="color: brown;">(</span><span style="color: navy;">obj</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Return a prettier version of obj.

    Parameters
    ----------
    obj : object
        Object to pretty print

    Returns
    -------
    str
        Pretty print object repr
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">sio</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">StringIO</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">pprint</span><span style="color: brown;">.</span><span style="color: olive;">pprint</span><span style="color: brown;">(</span><span style="color: navy;">obj</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">stream</span><span style="color: orange;">=</span><span style="color: navy;">sio</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">sio</span><span style="color: brown;">.</span><span style="color: olive;">getvalue</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">class</span>&nbsp;<span style="color: navy;">Scope</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Object to hold scope, with a few bells to deal with some custom syntax
    and contexts added by pandas.

    Parameters
    ----------
    level : int
    global_dict : dict or None, optional, default None
    local_dict : dict or Scope or None, optional, default None
    resolvers : list-like or None, optional, default None
    target : object

    Attributes
    ----------
    level : int
    scope : DeepChainMap
    target : object
    temps : dict
    "</span><span style="color: green;">""</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">__slots__</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">[</span><span style="color: green;">"level"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"scope"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"target"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"resolvers"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"temps"</span><span style="color: brown;">]</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">level</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">int</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">scope</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DeepChainMap</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">resolvers</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">DeepChainMap</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">temps</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">dict</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: purple;">__init__</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">level</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">global_dict</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">local_dict</span><span style="color: orange;">=</span><span style="color: purple;">None</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">resolvers</span><span style="color: orange;">=</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">target</span><span style="color: orange;">=</span><span style="color: purple;">None</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">level</span>&nbsp;<span style="color: orange;">+</span>&nbsp;<span style="color: blue;">1</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># shallow copy because we don't want to keep filling this up with what</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># was there before if there are multiple calls to Scope/_ensure_scope</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DeepChainMap</span><span style="color: brown;">(</span><span style="color: navy;">DEFAULT_GLOBALS</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">target</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">target</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Scope</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span><span style="color: brown;">.</span><span style="color: olive;">update</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">.</span><span style="color: navy;">scope</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">local_dict</span><span style="color: brown;">.</span><span style="color: navy;">target</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">target</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">local_dict</span><span style="color: brown;">.</span><span style="color: navy;">target</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: olive;">_update</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">frame</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">sys</span><span style="color: brown;">.</span><span style="color: olive;">_getframe</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">level</span><span style="color: brown;">)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">try</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># shallow copy here because we don't want to replace what's in</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># scope when we align terms (alignment accesses the underlying</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># numpy array of pandas objects)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">scope_global</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span><span style="color: brown;">.</span><span style="color: olive;">new_child</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">(</span><span style="color: navy;">global_dict</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">global_dict</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span>&nbsp;<span style="color: purple;">else</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">f_globals</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DeepChainMap</span><span style="color: brown;">(</span><span style="color: navy;">scope_global</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Scope</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">scope_local</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span><span style="color: brown;">.</span><span style="color: olive;">new_child</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">(</span><span style="color: navy;">local_dict</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">local_dict</span>&nbsp;<span style="color: purple;">is</span>&nbsp;<span style="color: purple;">not</span>&nbsp;<span style="color: purple;">None</span>&nbsp;<span style="color: purple;">else</span>&nbsp;<span style="color: navy;">frame</span><span style="color: brown;">.</span><span style="color: navy;">f_locals</span><span style="color: brown;">)</span><span style="color: brown;">.</span><span style="color: olive;">copy</span><span style="color: brown;">(</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DeepChainMap</span><span style="color: brown;">(</span><span style="color: navy;">scope_local</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">finally</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">del</span>&nbsp;<span style="color: navy;">frame</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: silver;"># assumes that resolvers are going from outermost scope to inner</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">Scope</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">resolvers</span>&nbsp;<span style="color: orange;">+</span><span style="color: orange;">=</span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">(</span><span style="color: navy;">local_dict</span><span style="color: brown;">.</span><span style="color: navy;">resolvers</span><span style="color: brown;">.</span><span style="color: navy;">maps</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">resolvers</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">DeepChainMap</span><span style="color: brown;">(</span><span style="color: red;">*r</span><span style="color: navy;">esolvers</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">temps</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">{</span><span style="color: brown;">}</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">def</span>&nbsp;<span style="color: purple;">__repr__</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">scope_keys</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_get_pretty_string</span><span style="color: brown;">(</span><span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">scope</span><span style="color: brown;">.</span><span style="color: olive;">keys</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">res_keys</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_get_pretty_string</span><span style="color: brown;">(</span><span style="color: olive;">list</span><span style="color: brown;">(</span><span style="color: navy;">self</span><span style="color: brown;">.</span><span style="color: navy;">resolvers</span><span style="color: brown;">.</span><span style="color: olive;">keys</span><span style="color: brown;">(</span><span style="color: brown;">)</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">f</span><span style="color: green;">"{type(self).__name__}(scope={scope_keys}, resolvers={res_keys})"</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;
</pre></body>
</html>