<!DOCTYPE html>
<html>
<head>
<title>Highlighted Code</title>
</head>
<body>
<div><h2>Gu√≠a de Colores</h2><ul><li><span style="color: red;">Error</span></li><li><span style="color: blue;">Numbers</span></li><li><span style="color: orange;">Operators</span></li><li><span style="color: navy;">Variables</span></li><li><span style="color: olive;">Functions</span></li><li><span style="color: purple;">Reserved</span></li><li><span style="color: green;">String</span></li><li><span style="color: silver;">Comments</span></li><li><span style="color: brown;">Keys_brackets_punctuation</span></li><li><span style="color: black;">Format</span></li></ul></div><hr><pre>
<span style="color: green;">""</span><span style="color: green;">"
:func:`~pandas.eval` parsers.
"</span><span style="color: green;">""</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">__future__</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">annotations</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">ast</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">functools</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">partial</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">reduce</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">keyword</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">iskeyword</span><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">tokenize</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">typing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Callable</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ClassVar</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">TypeVar</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">numpy</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">np</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">errors</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">UndefinedVariableError</span><br><br><span style="color: purple;">import</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">common</span>&nbsp;<span style="color: purple;">as</span>&nbsp;<span style="color: navy;">com</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">computation</span><span style="color: brown;">.</span><span style="color: navy;">ops</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">ARITH_OPS_SYMS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">BOOL_OPS_SYMS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">CMP_OPS_SYMS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">LOCAL_TAG</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">MATHOPS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">REDUCTIONS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">UNARY_OPS_SYMS</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">BinOp</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Constant</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Div</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">FuncNode</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Op</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">Term</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">UnaryOp</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">is_term</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">computation</span><span style="color: brown;">.</span><span style="color: navy;">parsing</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">clean_backtick_quoted_toks</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">tokenize_string</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">core</span><span style="color: brown;">.</span><span style="color: navy;">computation</span><span style="color: brown;">.</span><span style="color: navy;">scope</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">Scope</span><br><br><span style="color: purple;">from</span>&nbsp;<span style="color: navy;">pandas</span><span style="color: brown;">.</span><span style="color: navy;">io</span><span style="color: brown;">.</span><span style="color: navy;">formats</span>&nbsp;<span style="color: purple;">import</span>&nbsp;<span style="color: navy;">printing</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_rewrite_assign</span><span style="color: brown;">(</span><span style="color: navy;">tok</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Rewrite the assignment operator for PyTables expressions that use ``=``
    as a substitute for ``==``.

    Parameters
    ----------
    tok : tuple of int, str
        ints correspond to the all caps constants in the tokenize module

    Returns
    -------
    tuple of int, str
        Either the input or token or the replacement values
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">tok</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"=="</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: green;">"="</span>&nbsp;<span style="color: purple;">else</span>&nbsp;<span style="color: navy;">tokval</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_replace_booleans</span><span style="color: brown;">(</span><span style="color: navy;">tok</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Replace ``&`` with ``and`` and ``|`` with ``or`` so that bitwise
    precedence is changed to boolean precedence.

    Parameters
    ----------
    tok : tuple of int, str
        ints correspond to the all caps constants in the tokenize module

    Returns
    -------
    tuple of int, str
        Either the input or token or the replacement values
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">tok</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">toknum</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: navy;">OP</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: green;">"&"</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: navy;">NAME</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"and"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">elif</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: green;">"|"</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: navy;">NAME</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"or"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_replace_locals</span><span style="color: brown;">(</span><span style="color: navy;">tok</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: olive;">tuple</span><span style="color: brown;">[</span><span style="color: navy;">int</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">]</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Replace local variables with a syntactically valid name.

    Parameters
    ----------
    tok : tuple of int, str
        ints correspond to the all caps constants in the tokenize module

    Returns
    -------
    tuple of int, str
        Either the input or token or the replacement values

    Notes
    -----
    This is somewhat of a hack in that we rewrite a string such as ``'@a'`` as
    ``'__pd_eval_local_a'`` by telling the tokenizer that ``__pd_eval_local_``
    is a ``tokenize.OP`` and to replace the ``'@'`` symbol with it.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: navy;">tok</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: navy;">toknum</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: navy;">OP</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: navy;">tokval</span>&nbsp;<span style="color: orange;">=</span><span style="color: orange;">=</span>&nbsp;<span style="color: green;">"@"</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: navy;">OP</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">LOCAL_TAG</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">toknum</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">tokval</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_compose2</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">g</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Compose 2 callables.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: purple;">lambda</span>&nbsp;<span style="color: red;">*a</span><span style="color: navy;">rgs</span><span style="color: brown;">,</span>&nbsp;<span style="color: orange;">**</span><span style="color: navy;">kwargs</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: olive;">g</span><span style="color: brown;">(</span><span style="color: red;">*a</span><span style="color: navy;">rgs</span><span style="color: brown;">,</span>&nbsp;<span style="color: orange;">**</span><span style="color: navy;">kwargs</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_compose</span><span style="color: brown;">(</span><span style="color: red;">*f</span><span style="color: navy;">uncs</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Compose 2 or more callables.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: olive;">len</span><span style="color: brown;">(</span><span style="color: navy;">funcs</span><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">></span>&nbsp;<span style="color: blue;">1</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"At least 2 callables must be passed to compose"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">reduce</span><span style="color: brown;">(</span><span style="color: navy;">_compose2</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">funcs</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_preparse</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">source</span><span style="color: brown;">:</span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">f</span><span style="color: orange;">=</span><span style="color: olive;">_compose</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">_replace_locals</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">_replace_booleans</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">_rewrite_assign</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">clean_backtick_quoted_toks</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">)</span><span style="color: brown;">,</span><br><span style="color: brown;">)</span>&nbsp;<span style="color: orange;">-</span><span style="color: orange;">></span>&nbsp;<span style="color: navy;">str</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Compose a collection of tokenization functions.

    Parameters
    ----------
    source : str
        A Python source code string
    f : callable
        This takes a tuple of (toknum, tokval) as its argument and returns a
        tuple with the same structure but possibly different elements. Defaults
        to the composition of ``_rewrite_assign``, ``_replace_booleans``, and
        ``_replace_locals``.

    Returns
    -------
    str
        Valid Python source code

    Notes
    -----
    The `f` parameter can be any callable that takes *and* returns input of the
    form ``(toknum, tokval)``, where ``toknum`` is one of the constants from
    the ``tokenize`` module and ``tokval`` is a string.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">assert</span>&nbsp;<span style="color: olive;">callable</span><span style="color: brown;">(</span><span style="color: navy;">f</span><span style="color: brown;">)</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"f must be callable"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: navy;">tokenize</span><span style="color: brown;">.</span><span style="color: olive;">untokenize</span><span style="color: brown;">(</span><span style="color: olive;">f</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">x</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">tokenize_string</span><span style="color: brown;">(</span><span style="color: navy;">source</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_is_type</span><span style="color: brown;">(</span><span style="color: navy;">t</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Factory for a type checking function of type ``t`` or tuple of types.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: purple;">lambda</span>&nbsp;<span style="color: navy;">x</span><span style="color: brown;">:</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">.</span><span style="color: navy;">value</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">t</span><span style="color: brown;">)</span><br><br><br><span style="color: navy;">_is_list</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_is_type</span><span style="color: brown;">(</span><span style="color: navy;">list</span><span style="color: brown;">)</span><br><span style="color: navy;">_is_str</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_is_type</span><span style="color: brown;">(</span><span style="color: navy;">str</span><span style="color: brown;">)</span><br><br><br><span style="color: silver;"># partition all AST nodes</span><br><span style="color: navy;">_all_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">frozenset</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">node</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">node</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: brown;">(</span><span style="color: olive;">getattr</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">name</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">name</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: olive;">dir</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">isinstance</span><span style="color: brown;">(</span><span style="color: navy;">node</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">type</span><span style="color: brown;">)</span>&nbsp;<span style="color: purple;">and</span>&nbsp;<span style="color: olive;">issubclass</span><span style="color: brown;">(</span><span style="color: navy;">node</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">AST</span><span style="color: brown;">)</span><br><span style="color: brown;">)</span><br><br><br><span style="color: purple;">def</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">superclass</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">all_nodes</span><span style="color: orange;">=</span><span style="color: navy;">_all_nodes</span><span style="color: brown;">)</span><span style="color: brown;">:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">""</span><span style="color: green;">"
    Filter out AST nodes that are subclasses of ``superclass``.
    "</span><span style="color: green;">""</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">node_names</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">(</span><span style="color: navy;">node</span><span style="color: brown;">.</span><span style="color: navy;">__name__</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">node</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">all_nodes</span>&nbsp;<span style="color: purple;">if</span>&nbsp;<span style="color: olive;">issubclass</span><span style="color: brown;">(</span><span style="color: navy;">node</span><span style="color: brown;">,</span>&nbsp;<span style="color: navy;">superclass</span><span style="color: brown;">)</span><span style="color: brown;">)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: purple;">return</span>&nbsp;<span style="color: olive;">frozenset</span><span style="color: brown;">(</span><span style="color: navy;">node_names</span><span style="color: brown;">)</span><br><br><br><span style="color: navy;">_all_node_names</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">frozenset</span><span style="color: brown;">(</span><span style="color: navy;">x</span><span style="color: brown;">.</span><span style="color: navy;">__name__</span>&nbsp;<span style="color: purple;">for</span>&nbsp;<span style="color: navy;">x</span>&nbsp;<span style="color: purple;">in</span>&nbsp;<span style="color: navy;">_all_nodes</span><span style="color: brown;">)</span><br><span style="color: navy;">_mod_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">mod</span><span style="color: brown;">)</span><br><span style="color: navy;">_stmt_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">stmt</span><span style="color: brown;">)</span><br><span style="color: navy;">_expr_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">expr</span><span style="color: brown;">)</span><br><span style="color: navy;">_expr_context_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">expr_context</span><span style="color: brown;">)</span><br><span style="color: navy;">_boolop_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">boolop</span><span style="color: brown;">)</span><br><span style="color: navy;">_operator_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">operator</span><span style="color: brown;">)</span><br><span style="color: navy;">_unary_op_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">unaryop</span><span style="color: brown;">)</span><br><span style="color: navy;">_cmp_op_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">cmpop</span><span style="color: brown;">)</span><br><span style="color: navy;">_comprehension_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">comprehension</span><span style="color: brown;">)</span><br><span style="color: navy;">_handler_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">excepthandler</span><span style="color: brown;">)</span><br><span style="color: navy;">_arguments_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">arguments</span><span style="color: brown;">)</span><br><span style="color: navy;">_keyword_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">keyword</span><span style="color: brown;">)</span><br><span style="color: navy;">_alias_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">_filter_nodes</span><span style="color: brown;">(</span><span style="color: navy;">ast</span><span style="color: brown;">.</span><span style="color: navy;">alias</span><span style="color: brown;">)</span><br><br><br><span style="color: silver;"># nodes that we don't support directly but are needed for parsing</span><br><span style="color: navy;">_hacked_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">frozenset</span><span style="color: brown;">(</span><span style="color: brown;">[</span><span style="color: green;">"Assign"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"Module"</span><span style="color: brown;">,</span>&nbsp;<span style="color: green;">"Expr"</span><span style="color: brown;">]</span><span style="color: brown;">)</span><br><br><br><span style="color: navy;">_unsupported_expr_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: olive;">frozenset</span><span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">[</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Yield"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"GeneratorExp"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"IfExp"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"DictComp"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"SetComp"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Repr"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Lambda"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Set"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"AST"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"Is"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">"IsNot"</span><span style="color: brown;">,</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: brown;">]</span><br><span style="color: brown;">)</span><br><br><span style="color: silver;"># these nodes are low priority or won't ever be supported (e.g., AST)</span><br><span style="color: navy;">_unsupported_nodes</span>&nbsp;<span style="color: orange;">=</span>&nbsp;<span style="color: brown;">(</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: navy;">_stmt_nodes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;
</pre></body>
</html>